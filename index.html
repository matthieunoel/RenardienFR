<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width  initial-scale=1.0">
    <title>Trunic things</title>

    <style>
        @font-face {
            font-family: "Tunic";
            src: url("/font/Tunic.woff") format("woff2");
        }
        
        html body {
            margin: 0;
            padding: 2em;
            padding-bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - (2 * 2em));
            width: calc(100vw - (2 * 2em));
            flex-flow: column;
            overflow-x: hidden;
            background-color: #1e1e1f;
            font-family: 'Courier New', Courier, monospace;
        }
        
        html body table {
            margin-bottom: 2em;
        }
        
        html body table tr td,
        html body p {
            color: white;
            background-color: #3c3c42;
            border: 1px black solid;
            min-width: 1em;
            min-height: 1.5em;
            padding: 0.3em;
            text-align: center;
        }
        
        .tunic {
            font-family: Tunic;
        }
        
        #tunicTest {
            font-size: 2.5em;
        }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

    <script>
        // ##### Init consonnes_tunic & voyelles_tunic #####

        const firstString = "b d f ɡ h dʒ k ɫ m n ŋ p ɹ s ʃ ʒ t T ð tʃ v w j z";
        const secondString = "ə æ ɪ ʊ ɛ ɔ ɑ oʊ aɪ ɑɹ ɝ u i ɔɪ ɔɹ eɪ iɹ ɛɹ ʊs aʊ";

        const consonnes_tunic = firstString.split(" ");
        const voyelles_tunic = secondString.split(" ");

        // console.debug("voyelles :", voyelles_tunic);
        // console.debug("consonnes :", consonnes_tunic);
    </script>

    <script>
        // ##### Init fr_FR #####

        let fr_FR_words;
        let fr_FR_word_Initialised = false;
        $.getJSON("./fr_FR.json",
            (data) => {
                fr_FR_words = data.data;
                fr_FR_word_Initialised = true;
            })

        function checkFlag_fr_FR_words_Initialised(callBack) {
            // console.debug("callBack :", callBack);
            if (fr_FR_word_Initialised === false) {
                window.setTimeout(checkFlag_fr_FR_words_Initialised, 500, arguments = callBack); /* this checks the flag every 100 milliseconds*/
            } else {
                callBack();
            }
        }

        checkFlag_fr_FR_words_Initialised(function() {
            // console.debug("fr_FR :", fr_FR_words);
        });
    </script>

    <script>
        // ##### Init fr_FR_vocal #####

        let fr_FR_vocal;
        let fr_FR_vocal_Initialised = false;
        $.getJSON("./fr_FR_vocal.json",
            (data) => {
                fr_FR_vocal = data;

                let indexV = 0;
                let indexC = 0;
                for (let i = 0; i < fr_FR_vocal.length; i++) {
                    if (fr_FR_vocal[i].Type === "V") {
                        fr_FR_vocal[i].Tunic = voyelles_tunic[indexV];
                        indexV++;
                    } else {
                        fr_FR_vocal[i].Tunic = consonnes_tunic[indexC];
                        indexC++;
                    }
                }

                fr_FR_vocal_Initialised = true;

                // console.debug("fr_FR_vocal :", fr_FR_vocal);
            })

        function checkFlag_fr_FR_vocal_Initialised(callBack) {
            // console.debug("callBack :", callBack);
            if (fr_FR_vocal_Initialised === false) {
                window.setTimeout(checkFlag_fr_FR_vocal_Initialised, 500, arguments = callBack); /* this checks the flag every 100 milliseconds*/
            } else {
                callBack();
            }
        }
    </script>
</head>

<body>

    <table id="tunicTest">
        <tr>
            <td>
                Bonjour toi
            </td>
        </tr>
        <tr>
            <td>
                Bonjour toi
            </td>
        </tr>
        <tr>
            <td class="tunic">
                Bonjour toi
            </td>
        </tr>
    </table>

    <table id="trunicDoubleEntry">
    </table>

    <!-- Scripts section -->

    <script>
        checkFlag_fr_FR_words_Initialised(function() {
            let table = $("#tunicTest");
            // console.debug("table :", table);
            let the2ndLineTd = table.children().first().children("tr:nth-child(2)").children("td:first-child").get(0);
            // console.debug("the2ndLineTd :", the2ndLineTd);

            let texts = the2ndLineTd.innerText.trim().split(" ");
            // console.debug("texts :", texts);

            let newTexts = [];
            texts.forEach(text => {
                newTexts.push(fr_FR_words.find(e => e[0].toLowerCase() == text.toLowerCase())[1].replaceAll("/", ""));
            });
            // console.debug("newTexts :", newTexts);

            the2ndLineTd.innerText = newTexts.join(" ");




            // table.children().first().children("tr:nth-child(3)").children("td:first-child").get(0).innerText = newTexts.join(" ");

        });
    </script>

    <script>
        (function() {
            // let id = "trunicDoubleEntry";

            // const table = document.createElement("table");

            // for (let i = 0; i < voyelles.length; i++) {
            //     const row = document.createElement("tr");

            //     for (let j = 0; j < consonnes.length; j++) {
            //         const cell = document.createElement("td");
            //         cell.textContent = consonnes[j] + voyelles[i];
            //         row.appendChild(cell);
            //     }

            //     table.appendChild(row);
            // }

            // document.getElementById(id).innerHTML = table.innerHTML;
        })();
    </script>

    <script>
        checkFlag_fr_FR_words_Initialised(function() {
            let id = "trunicDoubleEntry";

            const table = document.createElement("table");

            let voyelles_fr = fr_FR_vocal.filter(e => {
                return e.Type === "V"
            });

            let consonnes_fr = fr_FR_vocal.filter(e => {
                return e.Type === "C"
            })

            // console.debug("voyelles_fr :", voyelles_fr);
            // console.debug("consonnes_fr :", consonnes_fr);

            const rowVoyelle = document.createElement("tr");
            const cellVoid = document.createElement("td");
            rowVoyelle.appendChild(cellVoid);

            for (let i = 0; i < voyelles_fr.length; i++) {
                const cell = document.createElement("td");
                cell.innerText = "/" + voyelles_fr[i].IPA.join("/, /") + "/"
                rowVoyelle.appendChild(cell);
            }

            table.appendChild(rowVoyelle);

            // for (let i = 0; i < consonnes_fr.length; i++) {
            //     const consonne_fr = consonnes_fr[i];

            // }

            // for (let i = 0; i < voyelles.length; i++) {
            //     const row = document.createElement("tr");

            //     for (let j = 0; j < consonnes.length; j++) {
            //         const cell = document.createElement("td");
            //         cell.textContent = consonnes[j] + voyelles[i];
            //         row.appendChild(cell);
            //     }

            //     table.appendChild(row);
            // }

            document.getElementById(id).innerHTML = table.innerHTML;
        });
    </script>

    <script>
        function FrVocalToTunic(input) {

            let voyelles_fr = fr_FR_vocal.filter(e => {
                return e.Type === "V"
            });

            let consonnes_fr = fr_FR_vocal.filter(e => {
                return e.Type === "C"
            })

            let res = "";
            Array.from(input).forEach(function(character) {
                if (character === " ") {
                    res += " ";
                    return;
                }
                var vocal = fr_FR_vocal.filter(e => {
                    return e.IPA.includes(character);
                })
                res += vocal[0].Tunic;
            });

            return res;

        }

        checkFlag_fr_FR_vocal_Initialised(function() {

            var test = FrVocalToTunic("bɔʒuʁ twa");
            // console.log("\"bɔʒuʁ twa\" => \"" + test + "\"");

            $("#tunicTest").children().first().children("tr:nth-child(3)").children("td:first-child").get(0).innerText = test;

        });
    </script>

</body>

<!-- CREDITS -->
<!-- Tunic font from http://trunic.wardbox.com/ -->
<!-- Data source for IPA from https://raw.githubusercontent.com/open-dict-data/ipa-dict/master/data/fr_FR.txt -->

</html>